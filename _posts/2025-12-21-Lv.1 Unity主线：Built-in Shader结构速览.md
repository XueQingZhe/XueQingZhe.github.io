---
layout: post
title: Lv.1 Unityä¸»çº¿ï¼šBuilt-in Shaderç»“æ„é€Ÿè§ˆ
date: 2025-12-21 
description: Built-in Shaderç»“æ„é€Ÿè§ˆ
tags: [shader, rendering, unity]
categories: [TAMonth01]
#tags: formatting code
#categories: sample-posts
featured: true
toc:
  sidebar: left # ç›®å½•
comments: true # è¯„è®º
photoswipe: true #å›¾ç‰‡æ”¾å¤§
---


# åŸºæœ¬ç»“æ„

![å›¾ç‰‡](/assets/img/TAMonth01/Pasted image 20251203164844.png)

# SubShader Tags

## Render Type

![å›¾ç‰‡](/assets/img/TAMonth01/Pasted image 20251203170938.png)

## Queue

![å›¾ç‰‡](/assets/img/TAMonth01/Pasted image 20251203171204.png)

## LOD

```c
SubShader
{
    LOD 300  // â† è¿™å°±æ˜¯LODå…³é”®å­—
    Pass { }
}
```

```c
// C#ä»£ç ä¸­è®¾ç½® Shader.globalMaximumLOD = 200;
// åªä½¿ç”¨LOD<=200çš„SubShader 
```

**é€‰æ‹©è§„åˆ™ï¼š**
å¦‚æœè®¾ç½® Shader.globalMaximumLOD = 200
SubShader LOD 300 â† è·³è¿‡ï¼ˆè¶…è¿‡é™åˆ¶ï¼‰
SubShader LOD 200 â† âœ… ä½¿ç”¨è¿™ä¸ª
SubShader LOD 100 â† ä¸ä¼šç”¨åˆ°ï¼ˆå› ä¸ºå·²ç»æ‰¾åˆ°åˆé€‚çš„ï¼‰

Unityå†…ç½®Shaderçš„LODæ ‡å‡†

### Unityå®˜æ–¹æ¨èçš„LODå€¼

| LODå€¼ | è´¨é‡ç­‰çº§ | ç¤ºä¾‹Shader                        |
| ---- | ---- | ------------------------------- |
| 600+ | æœ€é«˜è´¨é‡ | ç‰©ç†åŸºç¡€æ¸²æŸ“ + æ›²é¢ç»†åˆ†                   |
| 500  | éå¸¸é«˜  | VertexLit + æ‰€æœ‰åƒç´ å…‰               |
| 300  | é«˜    | Diffuse + Specular + Normal Map |
| 200  | ä¸­    | Diffuse + Specular              |
| 150  | ä¸­ä½   | Diffuse + ç®€åŒ–å…‰ç…§                  |
| 100  | ä½    | Vertex Litï¼ˆé¡¶ç‚¹å…‰ç…§ï¼‰                |
| 50   | æœ€ä½   | æ— å…‰ç…§                             |
**Unityå†…ç½®Shaderçš„LODå€¼ï¼š**

Standard Shader          = 300
Bumped Specular          = 300
Bumped Diffuse           = 200
Diffuse                  = 200
Specular                 = 200
VertexLit                = 100
Unlit                    = 100

## IgnoreProjector

**å¿½ç•¥æŠ•å½±**

```c
Tags { "IgnoreProjector"="True" }
```

![å›¾ç‰‡](/assets/img/TAMonth01/Pasted image 20251203171336.png)

## ForceNoShadowCasting

```c
Tags { "ForceNoShadowCasting"="True" }
```

![å›¾ç‰‡](/assets/img/TAMonth01/Pasted image 20251203171503.png)

## DisableBatching

```c
Tags { "DisableBatching"="True" }
```

![å›¾ç‰‡](/assets/img/TAMonth01/Pasted image 20251203171712.png)

## PreviewType

***ç»†èŠ‚é¢æ¿é¢„è§ˆå½¢çŠ¶***

```c
Tags { "PreviewType"="Plane" }
```

![å›¾ç‰‡](/assets/img/TAMonth01/Pasted image 20251203172058.png)

## CanUseSpriteAtlas

```c
Tags { "CanUseSpriteAtlas"="True" }
```

![å›¾ç‰‡](/assets/img/TAMonth01/Pasted image 20251203172147.png)

# Pass Tags

## LightMode

![å›¾ç‰‡](/assets/img/TAMonth01/Pasted image 20251203172447.png)
![å›¾ç‰‡](/assets/img/TAMonth01/Pasted image 20251203172705.png)

## RequireOptions

![å›¾ç‰‡](/assets/img/TAMonth01/Pasted image 20251203172836.png)

## PassFlags

![å›¾ç‰‡](/assets/img/TAMonth01/Pasted image 20251203173126.png)

# Pass keyworld

## Cull

![å›¾ç‰‡](/assets/img/TAMonth01/Pasted image 20251203173822.png)
![å›¾ç‰‡](/assets/img/TAMonth01/Pasted image 20251203174026.png)

## ZTest

![å›¾ç‰‡](/assets/img/TAMonth01/Pasted image 20251203173840.png)

```c
// æ™®é€šç‰©ä½“ï¼ˆé»˜è®¤ï¼‰
Pass
{
    ZTest LEqual  // è¿‘çš„è¦†ç›–è¿œçš„
}

// é€è§†æ•ˆæœï¼ˆXå…‰ï¼‰
Pass
{
    ZTest Greater  // åªæ˜¾ç¤ºè¢«é®æŒ¡çš„éƒ¨åˆ†
    
    CGPROGRAM
    fixed4 frag() : SV_Target
    {
        return fixed4(1, 0, 0, 0.5);  // åŠé€æ˜çº¢è‰²
    }
    ENDCG
}

// UI/å±å¹•ç©ºé—´æ•ˆæœ
Pass
{
    ZTest Always  // å¿½ç•¥æ·±åº¦ï¼Œæ€»æ˜¯æ˜¾ç¤º
}

// æè¾¹æ•ˆæœï¼ˆä¸¤ä¸ªPassï¼‰
// Pass 1: æ­£å¸¸æ¸²æŸ“
Pass
{
    ZTest LEqual
    CGPROGRAM
    // æ­£å¸¸æ¸²æŸ“
    ENDCG
}

// Pass 2: æè¾¹
Pass
{
    ZTest Greater  // åªæ¸²æŸ“è¢«é®æŒ¡çš„éƒ¨åˆ†ä½œä¸ºæè¾¹
    CGPROGRAM
    // æ”¾å¤§æ¨¡å‹ï¼Œæ¸²æŸ“è¾¹ç¼˜
    ENDCG
}
```

## ZWrite

![å›¾ç‰‡](/assets/img/TAMonth01/Pasted image 20251203173855.png)
![å›¾ç‰‡](/assets/img/TAMonth01/Pasted image 20251203173944.png)

## Blend æ··åˆæ¨¡å¼

```c
// åŸºç¡€è¯­æ³•
Blend SrcFactor DstFactor
Blend SrcFactor DstFactor, SrcFactorA DstFactorA  // åˆ†åˆ«æ§åˆ¶RGBå’ŒAlpha

// é«˜çº§è¯­æ³•
BlendOp Add/Sub/RevSub/Min/Max  // æ··åˆæ“ä½œ
```

**æ··åˆå› å­ï¼š**

| å› å­ | å«ä¹‰ |
|------|------|
| `One` | 1 |
| `Zero` | 0 |
| `SrcColor` | æºé¢œè‰² |
| `SrcAlpha` | æºAlpha |
| `DstColor` | ç›®æ ‡é¢œè‰² |
| `DstAlpha` | ç›®æ ‡Alpha |
| `OneMinusSrcColor` | 1 - æºé¢œè‰² |
| `OneMinusSrcAlpha` | 1 - æºAlpha |
| `OneMinusDstColor` | 1 - ç›®æ ‡é¢œè‰² |
| `OneMinusDstAlpha` | 1 - ç›®æ ‡Alpha |

**æ··åˆå…¬å¼ï¼š**

```c
æœ€ç»ˆé¢œè‰² = (æºé¢œè‰² * SrcFactor) BlendOp (ç›®æ ‡é¢œè‰² * DstFactor)
```

**å¸¸ç”¨æ··åˆæ¨¡å¼**

```c
// 1. æ ‡å‡†Alphaæ··åˆï¼ˆé€æ˜ï¼‰â­â­â­â­â­
Blend SrcAlpha OneMinusSrcAlpha
// æœ€ç»ˆ = æºé¢œè‰² * æºAlpha + ç›®æ ‡é¢œè‰² * (1 - æºAlpha)

// 2. åŠ æ³•æ··åˆï¼ˆå‘å…‰ã€ç²’å­ï¼‰â­â­â­â­â­
Blend One One
// æœ€ç»ˆ = æºé¢œè‰² + ç›®æ ‡é¢œè‰²

Blend SrcAlpha One  // æŸ”å’Œçš„åŠ æ³•
// æœ€ç»ˆ = æºé¢œè‰² * æºAlpha + ç›®æ ‡é¢œè‰²

// 3. ä¹˜æ³•æ··åˆï¼ˆé˜´å½±ã€æ»¤é•œï¼‰â­â­â­
Blend DstColor Zero
// æœ€ç»ˆ = ç›®æ ‡é¢œè‰² * æºé¢œè‰²

Blend Zero SrcColor  // ç­‰ä»·å†™æ³•
// æœ€ç»ˆ = æºé¢œè‰² * ç›®æ ‡é¢œè‰²

// 4. æ­£ç‰‡å åº•ï¼ˆPhotoshopçš„Multiplyï¼‰
Blend DstColor SrcColor
// æœ€ç»ˆ = æºé¢œè‰² * ç›®æ ‡é¢œè‰² + ç›®æ ‡é¢œè‰² * æºé¢œè‰²

// 5. å‡æ³•æ··åˆâ­â­
BlendOp Sub
Blend One One
// æœ€ç»ˆ = æºé¢œè‰² - ç›®æ ‡é¢œè‰²

BlendOp RevSub
Blend One One
// æœ€ç»ˆ = ç›®æ ‡é¢œè‰² - æºé¢œè‰²

// 6. æœ€å°å€¼/æœ€å¤§å€¼
BlendOp Min
Blend One One
// æœ€ç»ˆ = min(æºé¢œè‰², ç›®æ ‡é¢œè‰²)

BlendOp Max
Blend One One
// æœ€ç»ˆ = max(æºé¢œè‰², ç›®æ ‡é¢œè‰²)

// 7. é¢„ä¹˜Alpha
Blend One OneMinusSrcAlpha
// ç”¨äºå·²ç»é¢„ä¹˜äº†Alphaçš„çº¹ç†

// 8. æŸ”å…‰ï¼ˆSoft Additiveï¼‰
Blend OneMinusDstColor One
// äº®å¤„æ›´äº®ï¼Œæš—å¤„å½±å“å°

// 9. çº¿æ€§å‡æ·¡ï¼ˆScreenï¼‰
Blend OneMinusDstColor One
Blend One OneMinusSrcColor
```

**å®é™…åº”ç”¨ç¤ºä¾‹ï¼š**

```c
// ç«ç„°ç²’å­ï¼ˆåŠ æ³•æ··åˆï¼‰
Pass
{
    ZWrite Off
    Blend SrcAlpha One  // æŸ”å’ŒåŠ æ³•
    
    CGPROGRAM
    fixed4 frag() : SV_Target
    {
        fixed4 col = tex2D(_MainTex, i.uv);
        col.rgb *= _TintColor.rgb * 2;  // å¢å¼ºäº®åº¦
        return col;
    }
    ENDCG
}

// ç»ç’ƒï¼ˆæ ‡å‡†é€æ˜ï¼‰
Pass
{
    ZWrite Off
    Blend SrcAlpha OneMinusSrcAlpha
    
    CGPROGRAM
    fixed4 frag() : SV_Target
    {
        fixed4 col = tex2D(_MainTex, i.uv);
        col.a = 0.3;  // 30%é€æ˜åº¦
        return col;
    }
    ENDCG
}

// é˜´å½±æŠ•å°„ï¼ˆä¹˜æ³•æ··åˆï¼‰
Pass
{
    ZWrite Off
    Blend DstColor Zero  // æ­£ç‰‡å åº•
    
    CGPROGRAM
    fixed4 frag() : SV_Target
    {
        return fixed4(0.5, 0.5, 0.5, 1);  // 50%å˜æš—
    }
    ENDCG
}
```

## ColorMask(é¢œè‰²é®ç½©)

```c
ColorMask RGB   // å†™å…¥RGBï¼ˆé»˜è®¤ï¼‰
ColorMask A     // åªå†™å…¥Alpha
ColorMask 0     // ä¸å†™å…¥ä»»ä½•é¢œè‰²
ColorMask RGBA  // å†™å…¥æ‰€æœ‰é€šé“

// ç»„åˆä½¿ç”¨
ColorMask R     // åªå†™çº¢è‰²
ColorMask RG    // å†™çº¢è‰²å’Œç»¿è‰²
ColorMask BA    // å†™è“è‰²å’ŒAlpha
```

**åº”ç”¨åœºæ™¯ï¼š**

```c
// åªå†™æ·±åº¦ï¼Œä¸å†™é¢œè‰²ï¼ˆé€æ˜ç‰©ä½“é¢„å¤„ç†ï¼‰
Pass
{
    ZWrite On
    ColorMask 0  // ä¸å†™ä»»ä½•é¢œè‰²
}

// åªå†™Alphaé€šé“
Pass
{
    ColorMask A
    CGPROGRAM
    fixed4 frag() : SV_Target
    {
        return fixed4(0, 0, 0, _Alpha);
    }
    ENDCG
}

// æ¨¡æ¿ç¼“å†²é…åˆä½¿ç”¨
Pass
{
    ColorMask 0  // ä¸å†™é¢œè‰²
    
    Stencil
    {
        Ref 1
        Comp Always
        Pass Replace
    }
}
```

## Offsetï¼ˆæ·±åº¦åç§»ï¼‰

```c
Offset Factor, Units
```

**ä½œç”¨ï¼š**

- è°ƒæ•´æ·±åº¦å€¼ï¼Œé¿å…Z-Fightingï¼ˆæ·±åº¦å†²çªï¼‰
- `Factor`ï¼šåŸºäºå¤šè¾¹å½¢æ–œç‡çš„åç§»
- `Units`ï¼šå›ºå®šå•ä½åç§»

**åº”ç”¨åœºæ™¯ï¼š**

```c
// è´´èŠ±ï¼ˆDecalï¼‰
Pass
{
    Offset -1, -1  // å‘ç›¸æœºæ–¹å‘åç§»ï¼Œé¿å…Z-Fighting
    
    CGPROGRAM
    // æ¸²æŸ“è´´èŠ±
    ENDCG
}

// æè¾¹æ•ˆæœ
Pass
{
    Cull Front
    Offset 1, 1  // å‘ååç§»
    
    CGPROGRAM
    // æ¸²æŸ“èƒŒé¢ä½œä¸ºæè¾¹
    ENDCG
}
```

## Stencilï¼ˆæ¨¡æ¿ç¼“å†²ï¼‰

```c
Stencil
{
    Ref [_RefValue]         // å‚è€ƒå€¼ï¼ˆ0-255ï¼‰
    ReadMask [_ReadMask]    // è¯»å–é®ç½©ï¼ˆé»˜è®¤255ï¼‰
    WriteMask [_WriteMask]  // å†™å…¥é®ç½©ï¼ˆé»˜è®¤255ï¼‰
    
    Comp [comparison]       // æ¯”è¾ƒå‡½æ•°
    Pass [stencilOp]        // æµ‹è¯•é€šè¿‡æ—¶çš„æ“ä½œ
    Fail [stencilOp]        // æµ‹è¯•å¤±è´¥æ—¶çš„æ“ä½œ
    ZFail [stencilOp]       // æ·±åº¦æµ‹è¯•å¤±è´¥æ—¶çš„æ“ä½œ
}
```

**æ¯”è¾ƒå‡½æ•°ï¼ˆCompï¼‰ï¼š**

- `Never` - æ°¸ä¸é€šè¿‡
- `Less` - å°äº
- `Equal` - ç­‰äº
- `LEqual` - å°äºç­‰äº
- `Greater` - å¤§äº
- `NotEqual` - ä¸ç­‰äº
- `GEqual` - å¤§äºç­‰äº
- `Always` - æ€»æ˜¯é€šè¿‡

**æ“ä½œï¼ˆPass/Fail/ZFailï¼‰ï¼š**

- `Keep` - ä¿æŒä¸å˜
- `Zero` - è®¾ä¸º0
- `Replace` - æ›¿æ¢ä¸ºRefå€¼
- `IncrSat` - åŠ 1ï¼ˆé¥±å’Œï¼Œæœ€å¤§255ï¼‰
- `DecrSat` - å‡1ï¼ˆé¥±å’Œï¼Œæœ€å°0ï¼‰
- `Invert` - æŒ‰ä½å–å
- `IncrWrap` - åŠ 1ï¼ˆå¾ªç¯ï¼‰
- `DecrWrap` - å‡1ï¼ˆå¾ªç¯ï¼‰

**å®é™…åº”ç”¨ï¼šé®ç½©æ•ˆæœ**

```c
// ç¤ºä¾‹1ï¼šé®ç½©ä¸è¢«é®ç½©ç‰©ä½“

// é®ç½©ç‰©ä½“ï¼ˆå†™å…¥æ¨¡æ¿å€¼ï¼‰
Shader "Custom/StencilMask"
{
    SubShader
    {
        Tags { "Queue"="Geometry-1" }  // å…ˆæ¸²æŸ“
        
        Pass
        {
            ZWrite Off
            ColorMask 0  // ä¸å†™é¢œè‰²
            
            Stencil
            {
                Ref 1
                Comp Always
                Pass Replace  // å†™å…¥æ¨¡æ¿å€¼1
            }
            
            CGPROGRAM
            #pragma vertex vert
            #pragma fragment frag
            
            float4 frag() : SV_Target
            {
                return 0;
            }
            ENDCG
        }
    }
}

// è¢«é®ç½©ç‰©ä½“ï¼ˆåªåœ¨é®ç½©å†…æ˜¾ç¤ºï¼‰
Shader "Custom/StencilObject"
{
    SubShader
    {
        Tags { "Queue"="Geometry" }
        
        Pass
        {
            Stencil
            {
                Ref 1
                Comp Equal  // åªåœ¨æ¨¡æ¿å€¼ç­‰äº1çš„åœ°æ–¹æ¸²æŸ“
            }
            
            CGPROGRAM
            #pragma vertex vert
            #pragma fragment frag
            
            fixed4 frag() : SV_Target
            {
                return fixed4(1, 0, 0, 1);
            }
            ENDCG
        }
    }
}
```

**ç¤ºä¾‹2ï¼šæè¾¹æ•ˆæœ**

```c
SubShader
{
    // Pass 1: å†™å…¥æ¨¡æ¿
    Pass
    {
        Stencil
        {
            Ref 1
            Comp Always
            Pass Replace
        }
        
        CGPROGRAM
        // æ­£å¸¸æ¸²æŸ“ç‰©ä½“
        ENDCG
    }
    
    // Pass 2: æè¾¹ï¼ˆåªåœ¨ç‰©ä½“å¤–éƒ¨ï¼‰
    Pass
    {
        Cull Front
        
        Stencil
        {
            Ref 1
            Comp NotEqual  // ä¸ç­‰äº1çš„åœ°æ–¹ï¼ˆç‰©ä½“å¤–éƒ¨ï¼‰
        }
        
        CGPROGRAM
        // æ”¾å¤§å¹¶æ¸²æŸ“æè¾¹
        v.vertex.xyz += v.normal * _OutlineWidth;
        ENDCG
    }
}
```

**ç¤ºä¾‹3ï¼šä¼ é€é—¨æ•ˆæœ**

```c
// ä¼ é€é—¨é®ç½©
Shader "Custom/PortalMask"
{
    SubShader
    {
        Pass
        {
            ZWrite Off
            ColorMask 0
            
            Stencil
            {
                Ref 1
                Comp Always
                Pass Replace
            }
        }
    }
}

// ä¼ é€é—¨å¦ä¸€ä¾§çš„åœºæ™¯
Shader "Custom/PortalView"
{
    SubShader
    {
        Pass
        {
            Stencil
            {
                Ref 1
                Comp Equal
            }
            
            CGPROGRAM
            // æ¸²æŸ“å¦ä¸€ä¸ªåœºæ™¯
            ENDCG
        }
    }
}
```

## AlphaToMaskï¼ˆAlphaè½¬é®ç½©ï¼‰

```c
AlphaToMask On   // å¼€å¯ï¼ˆMSAAæ—¶æœ‰æ•ˆï¼‰
AlphaToMask Off  // å…³é—­ï¼ˆé»˜è®¤ï¼‰
```

**ä½œç”¨ï¼š**

- å°†Alphaå€¼è½¬æ¢ä¸ºè¦†ç›–é®ç½©
- ç”¨äºæŠ—é”¯é½¿ï¼ˆéœ€è¦å¼€å¯MSAAï¼‰
- é€‚åˆæ¤è¢«ç­‰Alpha Testç‰©ä½“

**åº”ç”¨åœºæ™¯ï¼š**

```c
// æ ‘å¶Shaderï¼ˆæ›´å¥½çš„è¾¹ç¼˜ï¼‰
Pass
{
    AlphaToMask On
    
    CGPROGRAM
    fixed4 frag() : SV_Target
    {
        fixed4 col = tex2D(_MainTex, i.uv);
        clip(col.a - _Cutoff);
        return col;
    }
    ENDCG
}
```

## Conservativeï¼ˆä¿å®ˆå…‰æ …åŒ–ï¼‰

```c
Conservative True   // å¼€å¯ä¿å®ˆå…‰æ …åŒ–
Conservative False  // å…³é—­ï¼ˆé»˜è®¤ï¼‰
```

**ä½œç”¨ï¼š**

- é«˜çº§åŠŸèƒ½ï¼Œç¡®ä¿ä¸‰è§’å½¢å®Œå…¨è¦†ç›–çš„åƒç´ éƒ½è¢«æ¸²æŸ“
- éœ€è¦ç¡¬ä»¶æ”¯æŒ

## å¸¸è§ç»„åˆæ€»ç»“

| æ•ˆæœç±»å‹  | Cull  | ZTest   | ZWrite | Blend                     |
| ----- | ----- | ------- | ------ | ------------------------- |
| ä¸é€æ˜ç‰©ä½“ | Back  | LEqual  | On     | Off                       |
| æ ‡å‡†é€æ˜  | Back  | LEqual  | Off    | SrcAlpha OneMinusSrcAlpha |
| åŠ æ³•ç²’å­  | Off   | LEqual  | Off    | One One                   |
| æè¾¹    | Front | LEqual  | On     | Off                       |
| UI    | Off   | Always  | Off    | SrcAlpha OneMinusSrcAlpha |
| å¤©ç©ºç›’   | Front | LEqual  | Off    | Off                       |
| Xå…‰é€è§†  | Back  | Greater | Off    | SrcAlpha OneMinusSrcAlpha |

## target

***Shader Modelç‰ˆæœ¬ï¼Œå¯ä»¥çœç•¥ã€‚Unityä¼šä½¿ç”¨é»˜è®¤å€¼ï¼štarget 2.5***

### è¯­æ³•

```c
#pragma target 2.0  // æŒ‡å®šæœ€ä½Shader Modelç‰ˆæœ¬
#pragma target 2.5
#pragma target 3.0
#pragma target 3.5
#pragma target 4.0
#pragma target 4.5
#pragma target 5.0
#pragma target 6.0
```

### Unityçš„Shader Modelç‰ˆæœ¬å¯¹ç…§

| Unity Target        | Shader Model | å¯¹åº”å¹´ä»£ | å¹³å°æ”¯æŒ              | å…³é”®åŠŸèƒ½                |
| ------------------- | ------------ | ---- | ----------------- | ------------------- |
| **2.0**             | SM 2.0       | 2004 | æ‰€æœ‰å¹³å°              | åŸºç¡€ç€è‰²å™¨               |
| **2.5**             | SM 2.0æ‰©å±•     | 2005 | PC, Console       | æ›´å¤šæŒ‡ä»¤                |
| **3.0**             | SM 3.0       | 2006 | PC, Console, é«˜ç«¯ç§»åŠ¨ | MRT, æ›´å¤šæ’å€¼å™¨          |
| **3.5** (GL ES 3.0) | SM 3.0+      | 2012 | ç°ä»£ç§»åŠ¨              | MRT, Compute Shader |
| **4.0**             | SM 4.0       | 2008 | DX10+             | å‡ ä½•ç€è‰²å™¨               |
| **4.5**             | SM 4.5       | 2009 | DX11+             | æ›²é¢ç»†åˆ†                |
| **5.0**             | SM 5.0       | 2011 | DX11+             | å®Œæ•´Compute Shader    |
| **6.0**             | SM 6.0       | 2018 | DX12, Vulkan      | å…‰çº¿è¿½è¸ªã€Mesh Shader    |

# é¡¶ç‚¹/ç‰‡å…ƒç€è‰²å™¨

## ç»“æ„ä½“

```c
struct appdata
{
    float4 vertex : POSITION;   // é¡¶ç‚¹ä½ç½®
    float3 normal : NORMAL;     // æ³•çº¿
    float4 tangent : TANGENT;   // åˆ‡çº¿
    float2 uv : TEXCOORD0;      // UV0
    float2 uv1 : TEXCOORD1;     // UV1ï¼ˆå…‰ç…§è´´å›¾ï¼‰
    float4 color : COLOR;       // é¡¶ç‚¹é¢œè‰²
};
```

**å®Œæ•´çš„é¡¶ç‚¹è¾“å…¥è¯­ä¹‰åˆ—è¡¨ï¼š**

| è¯­ä¹‰              | å«ä¹‰                   | æ•°æ®ç±»å‹          |
| --------------- | -------------------- | ------------- |
| `POSITION`      | é¡¶ç‚¹ä½ç½®ï¼ˆæ¨¡å‹ç©ºé—´ï¼‰           | float4        |
| `NORMAL`        | æ³•çº¿ï¼ˆæ¨¡å‹ç©ºé—´ï¼‰             | float3        |
| `TANGENT`       | åˆ‡çº¿ï¼ˆæ¨¡å‹ç©ºé—´ï¼‰             | float4        |
| `TEXCOORD0`     | ç¬¬ä¸€å¥—UV                | float2/float4 |
| `TEXCOORD1`     | ç¬¬äºŒå¥—UVï¼ˆå…‰ç…§è´´å›¾ï¼‰          | float2/float4 |
| `TEXCOORD2`     | ç¬¬ä¸‰å¥—UV                | float2/float4 |
| `TEXCOORD3`     | ç¬¬å››å¥—UV                | float2/float4 |
| `COLOR`         | é¡¶ç‚¹é¢œè‰²                 | float4        |
| `SV_VertexID`   | é¡¶ç‚¹ID                 | uint          |
| `SV_InstanceID` | å®ä¾‹IDï¼ˆGPU Instancingï¼‰ | uint          |

## TEXCOORDçš„æ•°é‡é™åˆ¶

### ä¸åŒShader Modelçš„æ”¯æŒ

Shader Model 2.0ï¼š

- æœ€å¤š8ä¸ªTEXCOORDï¼ˆ0-7ï¼‰
- æ¯ä¸ªæœ€å¤šfloat4
- æ€»å…±32ä¸ªfloat Shader Model
- 3.0ï¼š
- æœ€å¤š10ä¸ªTEXCOORDï¼ˆ0-9ï¼‰
- æ¯ä¸ªæœ€å¤šfloat4
- æ€»å…±40ä¸ªfloat Shader Model
- 4.0+ï¼š
- æœ€å¤š16ä¸ªæ’å€¼å™¨ - ä½¿ç”¨ä¸åŒçš„å‘½åï¼ˆä½†TEXCOORDä»ç„¶æœ‰æ•ˆï¼‰
Unityé»˜è®¤ï¼š

# pragma target 2.5

- æ”¯æŒ10ä¸ªTEXCOORDï¼ˆ0-9ï¼‰
å¦‚æœéœ€è¦æ›´å¤šï¼š

# pragma target 3.0 æˆ–æ›´é«˜

### **å®Œæ•´æ”¯æŒè¡¨**

|Shader Model|TEXCOORDæ•°é‡|æ¯ä¸ªç±»å‹|æ€»floatæ•°|Unity target|
|---|---|---|---|---|
|SM 2.0|8 (0-7)|float4|32|target 2.0|
|SM 2.5|10 (0-9)|float4|40|target 2.5ï¼ˆé»˜è®¤ï¼‰|
|SM 3.0|10 (0-9)|float4|40|target 3.0|
|SM 4.0+|16|float4|64|target 4.0+|

# ç‰‡å…ƒè¾“å‡ºè¯­ä¹‰

```c
fixed4 frag(v2f i) : SV_Target  // â† è¾“å‡ºåˆ°æ¸²æŸ“ç›®æ ‡
{
    return fixed4(1, 0, 0, 1);  // è¾“å‡ºçº¢è‰²
}
```

**å¸¸ç”¨è¾“å‡ºè¯­ä¹‰ï¼š**
***è¿™é‡Œè¯­ä¹‰ä¸»è¦æ˜¯å£°æ˜åœ¨Structä¸­çš„ï¼Œç‰‡å…ƒåé¢é»˜è®¤å°±SV_Targetæˆ–è€…è¯´æ˜¯SV_Target0ï¼Œå¦‚æœå¤šè¾“å‡ºçš„è¯å°±å¯ä»¥ä¸å†™***

|è¯­ä¹‰|å«ä¹‰|ç”¨é€”|
|---|---|---|
|`SV_Target`|æ¸²æŸ“ç›®æ ‡0|è¾“å‡ºé¢œè‰²åˆ°å±å¹•|
|`SV_Target0`|æ¸²æŸ“ç›®æ ‡0|åŒä¸Šï¼ˆæ˜ç¡®å†™0ï¼‰|
|`SV_Target1`|æ¸²æŸ“ç›®æ ‡1|å¤šæ¸²æŸ“ç›®æ ‡ï¼ˆMRTï¼‰|
|`SV_Target2`|æ¸²æŸ“ç›®æ ‡2|MRT|
|`SV_Target3`|æ¸²æŸ“ç›®æ ‡3|MRT|
|`SV_Depth`|æ·±åº¦å€¼|è‡ªå®šä¹‰æ·±åº¦|
|`COLOR`|é¢œè‰²ï¼ˆæ—§ç‰ˆï¼‰|è¢«SV_Targetå–ä»£|

# å»¶è¿Ÿç®¡çº¿

***å¤šè¾“å‡ºæ˜¯ä½¿ç”¨å»¶è¿Ÿç®¡çº¿ï¼Œå…ˆè¾“å‡ºå„ä¸ªå›¾ï¼Œç„¶åä¸€èµ·è®¡ç®—å…‰ç…§***

```c
// å¿…é¡»ç”¨ç»“æ„ä½“ + MRTï¼ˆä½†è¿˜æ˜¯ä¸€ä¸ªPassï¼ï¼‰
struct GBufferOutput
{
    fixed4 albedo : SV_Target0;
    fixed4 specular : SV_Target1;
    fixed4 normal : SV_Target2;
    fixed4 emission : SV_Target3;
};

GBufferOutput frag(v2f i)
{
    GBufferOutput o;
    o.albedo = tex2D(_MainTex, i.uv);
    o.specular = tex2D(_SpecMap, i.uv);
    o.normal = UnpackNormal(tex2D(_BumpMap, i.uv));
    o.emission = _Emission;
    return o;  // åŒæ—¶è¾“å‡º4ä¸ªå€¼ï¼Œåªè°ƒç”¨ä¸€æ¬¡ï¼
}
```

### å®ç°æ–¹æ³•å‚è€ƒ

```c
SubShader
{
    Pass
    {
        CGPROGRAM
        #pragma vertex vert
        #pragma fragment frag
        #pragma target 3.0  // MRTéœ€è¦SM3.0+
        
        sampler2D _MainTex;
        
        struct v2f
        {
            float4 pos : SV_POSITION;
            float2 uv : TEXCOORD0;
            float3 normal : TEXCOORD1;
            float depth : TEXCOORD2;
        };
        
        v2f vert(appdata_base v)
        {
            v2f o;
            o.pos = UnityObjectToClipPos(v.vertex);
            o.uv = v.texcoord;
            o.normal = UnityObjectToWorldNormal(v.normal);
            o.depth = o.pos.z;
            return o;
        }
        
        // å®šä¹‰å¤šè¾“å‡ºç»“æ„ä½“
        struct FragOutput
        {
            fixed4 albedo : SV_Target0;  // è¾“å‡ºåˆ°RT0
            fixed4 normal : SV_Target1;  // è¾“å‡ºåˆ°RT1
            fixed4 depth : SV_Target2;   // è¾“å‡ºåˆ°RT2
        };
        
        // ä¸€æ¬¡fragè°ƒç”¨ï¼ŒåŒæ—¶è¾“å‡º3ä¸ªå€¼
        FragOutput frag(v2f i)
        {
            FragOutput o;
            
            // åŒæ—¶è®¡ç®—æ‰€æœ‰æ•°æ®
            o.albedo = tex2D(_MainTex, i.uv);
            o.normal = fixed4(normalize(i.normal) * 0.5 + 0.5, 1);
            o.depth = fixed4(i.depth, i.depth, i.depth, 1);
            
            // ä¸€æ¬¡returnï¼ŒåŒæ—¶è¾“å‡ºåˆ°3ä¸ªRT
            return o;
        }
        ENDCG
    }
}

// ä¼˜ç‚¹ï¼š
// - åªæ‰§è¡Œä¸€æ¬¡é¡¶ç‚¹ç€è‰²å™¨
// - åªæ‰§è¡Œä¸€æ¬¡fragå‡½æ•°
// - GPUç¡¬ä»¶æ”¯æŒï¼Œéå¸¸é«˜æ•ˆ
// - è¿™å°±æ˜¯å»¶è¿Ÿæ¸²æŸ“çš„åŸºç¡€
```

---

## C#ç«¯å¦‚ä½•æ¥æ”¶å¤šæ¸²æŸ“ç›®æ ‡

```csharp
using UnityEngine;

public class MRTExample : MonoBehaviour
{
    public Shader mrtShader;
    private Material mrtMaterial;
    
    private RenderTexture rt0;  // Albedo
    private RenderTexture rt1;  // Normal
    private RenderTexture rt2;  // Depth
    
    void Start()
    {
        // åˆ›å»º3ä¸ªRenderTexture
        rt0 = new RenderTexture(512, 512, 0);
        rt1 = new RenderTexture(512, 512, 0);
        rt2 = new RenderTexture(512, 512, 0);
        
        mrtMaterial = new Material(mrtShader);
    }
    
    void OnRenderImage(RenderTexture source, RenderTexture destination)
    {
        // è®¾ç½®å¤šæ¸²æŸ“ç›®æ ‡ï¼ˆMRTï¼‰
        RenderBuffer[] colorBuffers = new RenderBuffer[3];
        colorBuffers[0] = rt0.colorBuffer;  // SV_Target0
        colorBuffers[1] = rt1.colorBuffer;  // SV_Target1
        colorBuffers[2] = rt2.colorBuffer;  // SV_Target2
        
        // ä¸€æ¬¡Graphics.Blitï¼ŒåŒæ—¶è¾“å‡ºåˆ°3ä¸ªRT
        Graphics.SetRenderTarget(colorBuffers, rt0.depthBuffer);
        Graphics.Blit(source, mrtMaterial);
        
        // ç°åœ¨rt0ã€rt1ã€rt2éƒ½å·²ç»å¡«å……äº†æ•°æ®
        // åªè°ƒç”¨äº†ä¸€æ¬¡fragå‡½æ•°ï¼
        
        // æ˜¾ç¤ºç»“æœ
        Graphics.Blit(rt0, destination);  // æ˜¾ç¤ºAlbedo
    }
    
    // è°ƒè¯•ï¼šæ˜¾ç¤º3ä¸ªRT
    void OnGUI()
    {
        GUI.DrawTexture(new Rect(0, 0, 256, 256), rt0);
        GUI.DrawTexture(new Rect(256, 0, 256, 256), rt1);
        GUI.DrawTexture(new Rect(512, 0, 256, 256), rt2);
    }
}
```

# æ•°æ®ç±»å‹å¿«é€Ÿå‚è€ƒè¡¨

### **ä¸€ã€ç²¾åº¦ç±»å‹å¯¹æ¯”**

| ç²¾åº¦ç±»å‹      | ä½æ•°  | èŒƒå›´        | ç²¾åº¦      | æ¡Œé¢æ€§èƒ½    | ç§»åŠ¨æ€§èƒ½ | è·¨å¹³å°ä¸€è‡´æ€§ | **æ¨èåº¦**   |
| --------- | --- | --------- | ------- | ------- | ---- | ------ | --------- |
| **half**  | 16ä½ | Â±60000    | ~0.001  | ç­‰äºfloat | â­â­â­  | â­â­â­â­   | âœ… **ä¸»åŠ›**  |
| **float** | 32ä½ | Â±3.4Ã—10Â³â¸ | ~7ä½æœ‰æ•ˆæ•°å­— | float   | â­    | â­â­â­â­â­  | âœ… **å¿…è¦æ—¶** |
| **fixed** | 11ä½ | [-2, 2]   | ~0.004  | ç­‰äºfloat | â­â­â­  | â­â­     | âŒ **é¿å…**  |

---

### **äºŒã€å¸¸ç”¨æ•°æ®ç±»å‹ç²¾åº¦é€‰æ‹©**

|æ•°æ®ç±»å‹|æ¨èç²¾åº¦|åŸå› |ç¤ºä¾‹|
|---|---|---|---|
|**ğŸ¨ é¢œè‰²ï¼ˆRGB/RGBAï¼‰**|`half4`|ç²¾åº¦è¶³å¤Ÿï¼Œè·¨å¹³å°ä¸€è‡´|`half4 color`|
|**ğŸ“ æ³•çº¿**|`half3`|å½’ä¸€åŒ–å‘é‡ï¼Œç²¾åº¦è¶³å¤Ÿ|`half3 normal`|
|**ğŸ“ åˆ‡çº¿/å‰¯åˆ‡çº¿**|`half3`|åŒæ³•çº¿|`half3 tangent`|
|**ğŸ—ºï¸ UVåæ ‡**|`half2`|é€šå¸¸å°èŒƒå›´|`half2 uv`|
|**ğŸ’¡ å…‰ç…§æ–¹å‘**|`half3`|å½’ä¸€åŒ–å‘é‡|`half3 lightDir`|
|**ğŸ‘ï¸ è§†çº¿æ–¹å‘**|`half3`|å½’ä¸€åŒ–å‘é‡|`half3 viewDir`|
|**âœ–ï¸ ç‚¹ç§¯ç»“æœï¼ˆNdotLç­‰ï¼‰**|`half`|[-1,1]èŒƒå›´|`half ndotl`|
|**ğŸšï¸ PBRç³»æ•°ï¼ˆé‡‘å±åº¦/ç²—ç³™åº¦ï¼‰**|`half`|[0,1]èŒƒå›´|`half metallic`|
|**ğŸ­ é®ç½©/Alpha**|`half`|[0,1]èŒƒå›´|`half mask`|
|**ğŸ“¦ çº¹ç†é‡‡æ ·ç»“æœ**|`half4`|ç›´æ¥è¿”å›half|`half4 tex2D(...)`|
|**ğŸŒ ä¸–ç•Œç©ºé—´åæ ‡**|`float3`|å¯èƒ½å¾ˆå¤§ï¼ˆå‡ åƒç±³ï¼‰|`float3 worldPos`|
|**ğŸ“ è£å‰ªç©ºé—´ä½ç½®**|`float4`|**å¿…é¡»**ï¼ˆSV_POSITIONï¼‰|`float4 pos`|
|**ğŸ”¢ çŸ©é˜µ**|`float4x4`|ç²¾åº¦è¦æ±‚é«˜|`float4x4 matrix`|
|**â±ï¸ æ—¶é—´/ç´¯åŠ è®¡ç®—**|`float`|é¿å…ç²¾åº¦æŸå¤±|`float time`|
|**ğŸ“ å¤§èŒƒå›´è·ç¦»**|`float`|å¯èƒ½å¾ˆå¤§|`float distance`|
|**ğŸ“ å¤æ‚æ•°å­¦å‡½æ•°**|`float`|sin/cos/expç­‰|`float sine`|
